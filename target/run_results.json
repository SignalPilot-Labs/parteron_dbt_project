{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0rc3", "generated_at": "2025-12-19T20:43:05.537668Z", "invocation_id": "35e7f40e-ef28-426a-96a7-96ffa8d671ca", "invocation_started_at": "2025-12-19T20:42:43.702361Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:49.193906Z", "completed_at": "2025-12-19T20:42:49.280423Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:49.280822Z", "completed_at": "2025-12-19T20:42:51.066780Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 2.4619839191436768, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-48af-1511-bbaf-33ae082bb327"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_engagement_events", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`engagement_events`\n),\n\nstaged as (\n    select\n        event_id,\n        patron_id,\n        creator_id,\n        post_id,\n        event_type,\n        event_at,\n        \n        -- Derived fields\n        date_trunc('month', event_at) as event_month,\n        date_trunc('day', event_at) as event_date,\n        \n        -- Engagement weighting (for composite scores)\n        case event_type\n            when 'view' then 1\n            when 'like' then 3\n            when 'comment' then 5\n            when 'share' then 7\n            else 1\n        end as engagement_weight,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_engagement_events`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:49.195838Z", "completed_at": "2025-12-19T20:42:49.286975Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:49.290966Z", "completed_at": "2025-12-19T20:42:51.069668Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 2.4632790088653564, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-48ae-18f2-9aaa-4b59d94b458c"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_patrons", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`patrons`\n),\n\nstaged as (\n    select\n        patron_id,\n        patron_name,\n        email,\n        country_code,\n        created_at,\n        first_pledge_at,\n        coalesce(lifetime_spend_usd, 0) as lifetime_spend_usd,\n        coalesce(status, 'active') as status,\n        \n        -- Derived fields\n        datediff(month, created_at, current_timestamp()) as account_age_months,\n        case \n            when lifetime_spend_usd >= 1000 then 'whale'\n            when lifetime_spend_usd >= 500 then 'high_value'\n            when lifetime_spend_usd >= 100 then 'regular'\n            else 'casual'\n        end as patron_value_tier,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_patrons`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:49.191819Z", "completed_at": "2025-12-19T20:42:49.203963Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:49.204207Z", "completed_at": "2025-12-19T20:42:51.084640Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.463991165161133, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-48af-11df-8832-bc3e3d84a230"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_creators", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`creators`\n),\n\nstaged as (\n    select\n        creator_id,\n        creator_name,\n        email,\n        category,\n        subcategory,\n        country_code,\n        coalesce(currency_code, 'USD') as currency_code,\n        coalesce(plan_type, 'pro') as plan_type,\n        coalesce(is_nsfw, false) as is_nsfw,\n        coalesce(is_verified, false) as is_verified,\n        created_at,\n        first_pledge_received_at,\n        last_post_at,\n        coalesce(status, 'active') as status,\n        \n        -- Derived fields\n        datediff(day, created_at, coalesce(first_pledge_received_at, current_timestamp())) as days_to_first_pledge,\n        datediff(month, created_at, current_timestamp()) as account_age_months,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_creators`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:51.640631Z", "completed_at": "2025-12-19T20:42:51.648310Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:51.648539Z", "completed_at": "2025-12-19T20:42:53.241131Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 2.1020050048828125, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-4a0e-107b-b282-109ae57feb04"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_posts", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`posts`\n),\n\nstaged as (\n    select\n        post_id,\n        creator_id,\n        title,\n        post_type,\n        access_level,\n        minimum_tier_id,\n        published_at,\n        coalesce(is_pinned, false) as is_pinned,\n        \n        -- Derived fields\n        date_trunc('month', published_at) as published_month,\n        date_trunc('day', published_at) as published_date,\n        \n        -- Content categorization\n        case \n            when access_level = 'public' then 'free'\n            when access_level = 'patrons_only' then 'paywalled'\n            when access_level = 'tier_specific' then 'premium'\n            else 'unknown'\n        end as content_access_type,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_posts`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:51.638041Z", "completed_at": "2025-12-19T20:42:51.645447Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:51.645728Z", "completed_at": "2025-12-19T20:42:53.318099Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 2.102705717086792, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-4a11-10cd-9652-5a186d3cc729"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_pledges", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`pledges`\n),\n\nstaged as (\n    select\n        pledge_id,\n        patron_id,\n        creator_id,\n        tier_id,\n        pledge_amount_usd,\n        pledge_status,\n        coalesce(is_first_pledge, false) as is_first_pledge,\n        started_at,\n        ended_at,\n        pause_started_at,\n        churn_reason,\n        \n        -- Derived fields\n        date_trunc('month', started_at) as pledge_month,\n        case \n            when pledge_status = 'active' then null\n            else datediff(day, started_at, coalesce(ended_at, current_timestamp()))\n        end as pledge_duration_days,\n        \n        -- Is currently active (for point-in-time analysis)\n        case \n            when pledge_status = 'active' and pause_started_at is null then true\n            else false\n        end as is_currently_active,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_pledges`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:51.643400Z", "completed_at": "2025-12-19T20:42:51.651287Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:51.651795Z", "completed_at": "2025-12-19T20:42:53.331407Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.250767946243286, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-4a0f-1503-b298-4f37775135aa"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_tiers", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`tiers`\n),\n\nstaged as (\n    select\n        tier_id,\n        creator_id,\n        tier_name,\n        tier_rank,\n        price_usd,\n        description,\n        coalesce(is_active, true) as is_active,\n        created_at,\n        archived_at,\n        \n        -- Price bucket for analysis\n        case \n            when price_usd <= 5 then 'micro'\n            when price_usd <= 15 then 'standard'\n            when price_usd <= 30 then 'premium'\n            else 'whale'\n        end as price_bucket,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_tiers`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:49.169459Z", "completed_at": "2025-12-19T20:42:50.202735Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:50.203031Z", "completed_at": "2025-12-19T20:42:53.701587Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 4.723482131958008, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-48e8-10e2-8a41-653167de7c49"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.metricflow_time_spine", "compiled": true, "compiled_code": "\n\nwith days as (\n    \n    \nwith base_dates as (\n    \n    with date_spine as\n(\n\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n     + \n    \n    p11.generated_number * power(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 4017\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        timestampadd(day, (row_number() over (order by 1) - 1), cast('2020-01-01' as timestamp))\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast('2030-12-31' as timestamp)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    cast(d.date_day as timestamp) as date_day\nfrom\n    date_spine d\n\n\n),\ndates_with_prior_year_dates as (\n\n    select\n        cast(d.date_day as date) as date_day,\n        cast(timestampadd(year, -1, d.date_day) as date) as prior_year_date_day,\n        cast(timestampadd(day, -364, d.date_day) as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n\n)\nselect\n    d.date_day,\n    cast(timestampadd(day, -1, d.date_day) as date) as prior_date_day,\n    cast(timestampadd(day, 1, d.date_day) as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    date_part('dayofweek', d.date_day) as day_of_week,\n    date_part('dayofweek_iso', d.date_day) as day_of_week_iso,\n    date_format(d.date_day, 'EEEE') as day_of_week_name,\n    date_format(d.date_day, 'E') as day_of_week_name_short,\n    date_part('day', d.date_day) as day_of_month,\n    dayofyear(d.date_day) as day_of_year,\n\n    cast(date_trunc('week', d.date_day) as date) as week_start_date,\n    cast(\n        timestampadd(day, -1, timestampadd(week, 1, date_trunc('week', d.date_day)))\n        as date) as week_end_date,\n    cast(date_trunc('week', d.prior_year_over_year_date_day) as date) as prior_year_week_start_date,\n    cast(\n        timestampadd(day, -1, timestampadd(week, 1, date_trunc('week', d.prior_year_over_year_date_day)))\n        as date) as prior_year_week_end_date,\n    cast(date_part('week', d.date_day) as integer) as week_of_year,\n\n    cast(date_trunc('week', d.date_day) as date) as iso_week_start_date,\n    cast(timestampadd(day, 6, cast(date_trunc('week', d.date_day) as date)) as date) as iso_week_end_date,\n    cast(date_trunc('week', d.prior_year_over_year_date_day) as date) as prior_year_iso_week_start_date,\n    cast(timestampadd(day, 6, cast(date_trunc('week', d.prior_year_over_year_date_day) as date)) as date) as prior_year_iso_week_end_date,\n    cast(date_part('week', d.date_day) as integer) as iso_week_of_year,\n\n    cast(date_part('week', d.prior_year_over_year_date_day) as integer) as prior_year_week_of_year,\n    cast(date_part('week', d.prior_year_over_year_date_day) as integer) as prior_year_iso_week_of_year,\n\n    cast(date_part('month', d.date_day) as integer) as month_of_year,\n    date_format(d.date_day, 'MMMM')  as month_name,\n    date_format(d.date_day, 'MMM')  as month_name_short,\n\n    cast(date_trunc('month', d.date_day) as date) as month_start_date,\n    cast(cast(\n        timestampadd(day, -1, timestampadd(month, 1, date_trunc('month', d.date_day)))\n        as date) as date) as month_end_date,\n\n    cast(date_trunc('month', d.prior_year_date_day) as date) as prior_year_month_start_date,\n    cast(cast(\n        timestampadd(day, -1, timestampadd(month, 1, date_trunc('month', d.prior_year_date_day)))\n        as date) as date) as prior_year_month_end_date,\n\n    cast(date_part('quarter', d.date_day) as integer) as quarter_of_year,\n    cast(date_trunc('quarter', d.date_day) as date) as quarter_start_date,\n    cast(cast(\n        timestampadd(day, -1, timestampadd(quarter, 1, date_trunc('quarter', d.date_day)))\n        as date) as date) as quarter_end_date,\n\n    cast(date_part('year', d.date_day) as integer) as year_number,\n    cast(date_trunc('year', d.date_day) as date) as year_start_date,\n    cast(cast(\n        timestampadd(day, -1, timestampadd(year, 1, date_trunc('year', d.date_day)))\n        as date) as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\n\nselect\n    date_day as date_day\nfrom days", "relation_name": "`patreon_dev`.`analytics`.`metricflow_time_spine`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:53.892693Z", "completed_at": "2025-12-19T20:42:53.899744Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:53.900000Z", "completed_at": "2025-12-19T20:42:55.272971Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 1.681297779083252, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-4b51-140d-8066-bbf595e09ecb"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.stg_transactions", "compiled": true, "compiled_code": "with source as (\n    select * from `patreon_dev`.`analytics_raw`.`transactions`\n),\n\nstaged as (\n    select\n        transaction_id,\n        pledge_id,\n        patron_id,\n        creator_id,\n        transaction_type,\n        transaction_status,\n        gross_amount_usd,\n        platform_fee_usd,\n        processing_fee_usd,\n        net_amount_usd,\n        payment_method,\n        failure_reason,\n        transaction_at,\n        \n        -- Derived fields\n        date_trunc('month', transaction_at) as transaction_month,\n        date_trunc('day', transaction_at) as transaction_date,\n        \n        -- Fee analysis\n        case \n            when gross_amount_usd > 0 and transaction_status = 'succeeded'\n            then round((platform_fee_usd / gross_amount_usd) * 100, 2)\n            else null\n        end as platform_fee_rate_pct,\n        \n        case \n            when gross_amount_usd > 0 and transaction_status = 'succeeded'\n            then round((processing_fee_usd / gross_amount_usd) * 100, 2)\n            else null\n        end as processing_fee_rate_pct,\n        \n        -- Success flag\n        case when transaction_status = 'succeeded' then 1 else 0 end as is_successful,\n        \n        current_timestamp() as _stg_loaded_at\n        \n    from source\n)\n\nselect * from staged", "relation_name": "`patreon_dev`.`analytics_staging`.`stg_transactions`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-19T20:42:55.428234Z", "completed_at": "2025-12-19T20:42:55.440826Z"}, {"name": "execute", "started_at": "2025-12-19T20:42:55.441239Z", "completed_at": "2025-12-19T20:43:05.363105Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 10.099910974502563, "adapter_response": {"_message": "OK", "query_id": "01f0dd1b-4c43-122c-8cc7-62e86b96eade"}, "message": "OK", "failures": null, "unique_id": "model.patreon_analytics.fct_creator_monthly_performance", "compiled": true, "compiled_code": "\n\nwith creators as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_creators`\n),\n\npledges as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_pledges`\n),\n\ntransactions as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_transactions`\n),\n\ntiers as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_tiers`\n),\n\nposts as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_posts`\n),\n\nengagement as (\n    select * from `patreon_dev`.`analytics_staging`.`stg_engagement_events`\n),\n\n-- Generate month spine from earliest pledge to current month\nmonths as (\n    select distinct date_trunc('month', transaction_at)::date as month_start_date\n    from transactions\n),\n\n-- Create creator-month combinations\ncreator_months as (\n    select \n        c.creator_id,\n        m.month_start_date,\n        md5(cast(concat(coalesce(cast(c.creator_id as string), '_dbt_utils_surrogate_key_null_'), '-', coalesce(cast(m.month_start_date as string), '_dbt_utils_surrogate_key_null_')) as string)) as creator_month_key\n    from creators c\n    cross join months m\n    where m.month_start_date >= date_trunc('month', c.first_pledge_received_at)\n),\n\n-- Monthly pledge metrics\npledge_metrics as (\n    select\n        p.creator_id,\n        date_trunc('month', t.transaction_at)::date as month_start_date,\n        \n        -- Patron counts\n        count(distinct p.patron_id) as total_patrons,\n        count(distinct case when p.pledge_status = 'active' then p.patron_id end) as active_patrons,\n        count(distinct case when p.is_first_pledge = true then p.patron_id end) as new_patrons,\n        count(distinct case when p.pledge_status = 'churned' then p.patron_id end) as churned_patrons,\n        \n        -- MRR\n        sum(case when p.pledge_status = 'active' then p.pledge_amount_usd else 0 end) as gross_mrr_usd,\n        sum(case when p.is_first_pledge = true then p.pledge_amount_usd else 0 end) as new_mrr_usd,\n        sum(case when p.pledge_status = 'churned' then p.pledge_amount_usd else 0 end) as churned_mrr_usd,\n        \n        -- Tier distribution\n        count(distinct case when ti.tier_rank = 1 then p.patron_id end) as tier_1_patrons,\n        count(distinct case when ti.tier_rank = 2 then p.patron_id end) as tier_2_patrons,\n        count(distinct case when ti.tier_rank >= 3 then p.patron_id end) as tier_3_plus_patrons,\n        \n        -- ARPP\n        avg(p.pledge_amount_usd) as avg_pledge_amount_usd\n        \n    from pledges p\n    inner join transactions t on p.pledge_id = t.pledge_id\n    left join tiers ti on p.tier_id = ti.tier_id\n    group by 1, 2\n),\n\n-- Monthly revenue (actual collections)\nrevenue_metrics as (\n    select\n        creator_id,\n        date_trunc('month', transaction_at)::date as month_start_date,\n        \n        sum(case when transaction_status = 'succeeded' then gross_amount_usd else 0 end) as gross_revenue_usd,\n        sum(case when transaction_status = 'succeeded' then platform_fee_usd else 0 end) as platform_fees_usd,\n        sum(case when transaction_status = 'succeeded' then processing_fee_usd else 0 end) as processing_fees_usd,\n        sum(case when transaction_status = 'succeeded' then net_amount_usd else 0 end) as net_creator_earnings_usd,\n        \n        count(case when transaction_status = 'succeeded' then 1 end) as successful_transactions,\n        count(case when transaction_status = 'failed' then 1 end) as failed_transactions,\n        sum(case when transaction_status = 'failed' then gross_amount_usd else 0 end) as declined_amount_usd\n        \n    from transactions\n    where transaction_type = 'pledge_payment'\n    group by 1, 2\n),\n\n-- Monthly content metrics\ncontent_metrics as (\n    select\n        creator_id,\n        published_month as month_start_date,\n        \n        count(distinct post_id) as posts_published,\n        count(distinct case when content_access_type = 'paywalled' then post_id end) as paywalled_posts,\n        count(distinct case when content_access_type = 'free' then post_id end) as free_posts\n        \n    from posts\n    group by 1, 2\n),\n\n-- Monthly engagement metrics\nengagement_metrics as (\n    select\n        creator_id,\n        event_month as month_start_date,\n        \n        count(case when event_type = 'view' then 1 end) as total_views,\n        count(case when event_type = 'like' then 1 end) as total_likes,\n        count(case when event_type = 'comment' then 1 end) as total_comments,\n        count(distinct patron_id) as engaged_patrons,\n        sum(engagement_weight) as total_engagement_score\n        \n    from engagement\n    group by 1, 2\n),\n\n-- Previous month for growth calculations\nlagged as (\n    select\n        creator_id,\n        month_start_date,\n        lag(gross_mrr_usd) over (partition by creator_id order by month_start_date) as prev_mrr,\n        lag(active_patrons) over (partition by creator_id order by month_start_date) as prev_patrons\n    from pledge_metrics\n)\n\nselect\n    cm.creator_month_key,\n    cm.creator_id,\n    cm.month_start_date,\n    \n    -- Creator attributes\n    c.creator_name,\n    c.category as creator_category,\n    c.plan_type,\n    c.country_code as creator_country,\n    \n    -- Patron metrics\n    coalesce(pm.total_patrons, 0) as total_patrons,\n    coalesce(pm.active_patrons, 0) as active_patrons,\n    coalesce(pm.new_patrons, 0) as new_patrons,\n    coalesce(pm.churned_patrons, 0) as churned_patrons,\n    coalesce(pm.active_patrons, 0) - coalesce(l.prev_patrons, 0) as net_patron_change,\n    \n    case \n        when coalesce(l.prev_patrons, 0) > 0 \n        then round((pm.churned_patrons * 100.0 / l.prev_patrons), 2)\n        else 0 \n    end as patron_churn_rate_pct,\n    \n    -- MRR metrics\n    coalesce(pm.gross_mrr_usd, 0) as gross_mrr_usd,\n    coalesce(pm.new_mrr_usd, 0) as new_mrr_usd,\n    coalesce(pm.churned_mrr_usd, 0) as churned_mrr_usd,\n    coalesce(pm.gross_mrr_usd, 0) - coalesce(l.prev_mrr, 0) as mrr_change_usd,\n    \n    case \n        when coalesce(l.prev_mrr, 0) > 0 \n        then round(((pm.gross_mrr_usd - l.prev_mrr) * 100.0 / l.prev_mrr), 2)\n        else null \n    end as mrr_growth_rate_pct,\n    \n    -- Revenue metrics\n    coalesce(rm.gross_revenue_usd, 0) as gross_revenue_usd,\n    coalesce(rm.platform_fees_usd, 0) as platform_fees_usd,\n    coalesce(rm.processing_fees_usd, 0) as processing_fees_usd,\n    coalesce(rm.net_creator_earnings_usd, 0) as net_creator_earnings_usd,\n    \n    case \n        when coalesce(pm.gross_mrr_usd, 0) > 0 \n        then round((rm.gross_revenue_usd * 100.0 / pm.gross_mrr_usd), 2)\n        else null \n    end as collection_rate_pct,\n    \n    -- Payment health\n    coalesce(rm.successful_transactions, 0) as successful_transactions,\n    coalesce(rm.failed_transactions, 0) as failed_transactions,\n    coalesce(rm.declined_amount_usd, 0) as declined_amount_usd,\n    \n    case \n        when coalesce(rm.successful_transactions, 0) + coalesce(rm.failed_transactions, 0) > 0\n        then round((rm.failed_transactions * 100.0 / (rm.successful_transactions + rm.failed_transactions)), 2)\n        else 0 \n    end as decline_rate_pct,\n    \n    -- Tier distribution\n    coalesce(pm.tier_1_patrons, 0) as tier_1_patrons,\n    coalesce(pm.tier_2_patrons, 0) as tier_2_patrons,\n    coalesce(pm.tier_3_plus_patrons, 0) as tier_3_plus_patrons,\n    coalesce(pm.avg_pledge_amount_usd, 0) as avg_pledge_amount_usd,\n    \n    -- Content metrics\n    coalesce(cnt.posts_published, 0) as posts_published,\n    coalesce(cnt.paywalled_posts, 0) as paywalled_posts,\n    coalesce(cnt.free_posts, 0) as free_posts,\n    \n    -- Engagement metrics\n    coalesce(eng.total_views, 0) as total_views,\n    coalesce(eng.total_likes, 0) as total_likes,\n    coalesce(eng.total_comments, 0) as total_comments,\n    coalesce(eng.engaged_patrons, 0) as engaged_patrons,\n    coalesce(eng.total_engagement_score, 0) as total_engagement_score,\n    \n    case \n        when coalesce(pm.active_patrons, 0) > 0 \n        then round((eng.engaged_patrons * 100.0 / pm.active_patrons), 2)\n        else null \n    end as patron_engagement_rate_pct,\n    \n    current_timestamp() as updated_at\n\nfrom creator_months cm\nleft join creators c on cm.creator_id = c.creator_id\nleft join pledge_metrics pm on cm.creator_id = pm.creator_id and cm.month_start_date = pm.month_start_date\nleft join revenue_metrics rm on cm.creator_id = rm.creator_id and cm.month_start_date = rm.month_start_date\nleft join content_metrics cnt on cm.creator_id = cnt.creator_id and cm.month_start_date = cnt.month_start_date\nleft join engagement_metrics eng on cm.creator_id = eng.creator_id and cm.month_start_date = eng.month_start_date\nleft join lagged l on cm.creator_id = l.creator_id and cm.month_start_date = l.month_start_date", "relation_name": "`patreon_dev`.`analytics_marts`.`fct_creator_monthly_performance`", "batch_results": null}], "elapsed_time": 20.14293599128723, "args": {"upload_to_artifacts_ingest_api": false, "show_resource_report": false, "require_resource_names_without_spaces": true, "defer": false, "favor_state": false, "require_unique_project_resource_names": false, "require_nested_cumulative_type_params": false, "show_all_deprecations": false, "profiles_dir": "/Users/tarik/codeAlpine/sp-demo/patreon_dbt_project", "vars": {}, "use_colors": true, "use_fast_test_edges": false, "send_anonymous_usage_stats": true, "cache_selected_only": false, "require_explicit_package_overrides_for_builtin_materializations": true, "which": "run", "use_colors_file": true, "log_format_file": "debug", "require_batched_execution_for_custom_microbatch_strategy": false, "strict_mode": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "partial_parse": true, "require_generic_test_arguments_property": true, "log_file_max_bytes": 10485760, "indirect_selection": "eager", "partial_parse_file_diff": true, "state_modified_compare_vars": false, "require_all_warnings_handled_by_warn_error": false, "skip_nodes_if_on_run_start_fails": false, "invocation_command": "dbt run", "state_modified_compare_more_unrendered_values": false, "log_level_file": "debug", "version_check": true, "quiet": false, "macro_debugging": false, "select": [], "write_json": true, "log_level": "info", "source_freshness_run_project_hooks": true, "static_parser": true, "empty": false, "introspect": true, "log_format": "default", "log_path": "/Users/tarik/codeAlpine/sp-demo/patreon_dbt_project/logs", "printer_width": 80, "require_yaml_configuration_for_mf_time_spines": false, "validate_macro_args": false, "print": true, "populate_cache": true, "project_dir": "/Users/tarik/codeAlpine/sp-demo/patreon_dbt_project", "exclude": []}}